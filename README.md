# Scrapping-Instagram-Post

#1
import instaloader
import pandas as pd
from datetime import datetime
from itertools import dropwhile, takewhile
import os
import json
from glob2 import glob
from openpyxl.workbook import Workbook 

#2
   # Create an instaloader object with parameters
   L = instaloader.Instaloader(download_pictures = False, download_videos = False, download_comments= False, compress_json = False)
   
   # Log in with the instaloader object
   L.login("username" , "password")

#3
L = instaloader.Instaloader()

posts = instaloader.Profile.from_username(L.context, "account instagram").get_posts()

enddate = datetime(2021, 9, 13)
startdate = datetime(2021, 8, 1)

for post in takewhile(lambda p: p.date > startdate, dropwhile(lambda p: p.date > enddate, posts)):
    print(post.date)
    L.download_post(post, "stunting_kit")
# get your current working directory
current_wkdir = os.getcwd()

#ekstrak here semua file di folder tsb

#4
username ="stunting_kit"
def parse_instafiles(username, path):
    """ 
    This function loads in all the json files generated by the      instaloader package and parses it into a csv file.
    """
    #print('Entering provided directory...')
    os.chdir(os.path.join(path, username))
    
    columns = ['filename', 'datetime', 'type', 'locations_id', 'locations_name', 'mentions', 'hashtags', 'video_duration']
    
    dataframe = pd.DataFrame(columns=[])
    
    #print('Traversing file tree...')
    
    glob('*UTC.json')
    
    for file in glob('*UTC.json'):
        with open(file, 'r') as filecontent:
            filename = filecontent.name
            #print('Found JSON file: ' + filename + '. Loading...')
            
            try:
                metadata = json.loads(filecontent.read())
            
            except IOError as e:
                #print("I/O Error. Couldn't load file. Trying the next one...")
                continue
            else:
                pass
            #print('Collecting relevant metadata...')
            time = datetime.fromtimestamp(int(metadata['node']['taken_at_timestamp']))
            type_ = metadata['node']['__typename']
            likes = metadata['node']['edge_media_preview_like']['count']     
            comments = metadata['node']['edge_media_to_comment']['count']
            username = metadata['node']['owner']['username']
            followers = metadata['node']['owner']['edge_followed_by']['count']
            try:
                text = metadata['node']['edge_media_to_caption']['edges'][0]['node']['text']
            except:
                text = ""
            try:
                post_id = metadata['node']['id']
            except:
                post_id = ""
            try:
                video_view_count = metadata['node']['video_view_count']
            except:
                post_id = ""
            minedata = {'filename': filename, 'time': time, 'text': text, 'type_' : type_, 'video_view_count' : video_view_count,
                    'likes': likes, 'comments' : comments, 'username' : username,  'followers' : followers, 'post_id' : post_id}
            #print('Writing to dataframe...')
            dataframe = dataframe.append(minedata, ignore_index=True)
            #print('Closing file...')
            del metadata
            filecontent.close()
    #print('Storing dataframe to CSV file...')
    #print('Done.')
    dataframe['source'] = 'Instagram'
    return dataframe

#5
df_instagram = parse_instafiles(username, os.getcwd() )
df_instagram.to_excel("your file name.xlsx")
